branches:
  only:
  - master
  - hookshot-replacement
before_install:
- sudo apt update
- sudo apt install software-properties-common
- sudo apt-add-repository --yes --update ppa:ansible/ansible
- sudo apt install -y ansible
- echo 'echo $SSH_PASSPHRASE' > ./dummy-askpass.sh
- chmod +x ./dummy-askpass.sh
- chmod 0600 ./deploy/id_ed25519-robocoup-people.bocoup.com
- echo '|1|7VSJ1jcNhoYF62Lm8gCa//6Y+qI=|5JKYF+JbVCswOd7AZsILaQBHhDw= ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBOryT+Krc5KhTmuQ3cZHnG9cGxbzWciCT+Cohuw8P9HYdT7VWQmpFxd+QMRargWzMs86LN8k0j5a6KkNJw9ie4E=' >> $HOME/.ssh/known_hosts
script:
- eval "$(ssh-agent -s)"
- DISPLAY=1 SSH_ASKPASS=./dummy-askpass.sh ssh-add ./deploy/id_ed25519-robocoup-people.bocoup.com < /dev/null
- ansible-playbook deploy/ansible/deploy.yml --user robocoup --inventory=deploy/ansible/inventory/production
